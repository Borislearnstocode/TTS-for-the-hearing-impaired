library(tidyverse)
library(lme4)
library(lmerTest)
library(performance)
library(multcomp)
library(emmeans)
library(ggplot2)

# Read the MOS long file and adjust the data 
MOS_long <- read_csv("MOS_long.csv")
MOS_long <- subset(MOS_long, select = -c(1))
MOS_wide <- read_csv('MOS.csv')

# Calculate MOS and other statistics
MOS_stats <- MOS_long %>% 
  mutate(stimuli = factor(stimuli)) %>% 
  group_by(stimuli) %>% 
  summarize(mos = mean(scores),
         sd_mos = sd(scores),
         se_mos = sd_mos / sqrt(n()))

# GLM & ANOVA
glm_mos <- lmer(scores ~ stimuli + (1|part_num), data = MOS_long, REML = FALSE)
print(glm_mos)
summary(glm_mos)
icc(glm_mos) # adjusted ICC = 0.429

anova_mos <- anova(glm_mos, type = 2)     # I somehow compared the differences between different commands here.
summary(anova_mos)

ANOVA <-  aov(scores ~ as.factor(stimuli) + Error(as.factor(part_num)/as.factor(stimuli)), MOS_long)
summary(ANOVA)


# Perform Tukey's HSD test, using bonferroni
posthoc_results <- emmeans(glm_mos,list(pairwise ~ stimuli), adjust = "Bonferroni")

# View the results
print(posthoc_results)
